# Условное отображение параметров в UPDL-узлах

## Обзор

UPDL-узлы поддерживают условное отображение параметров, позволяя показывать только релевантные поля в диалоге "Дополнительные параметры" на основе значений других полей. Эта функция значительно улучшает пользовательский опыт, уменьшая загромождение интерфейса и показывая только те параметры, которые применимы к текущей конфигурации.

## Как это работает

Система условного отображения использует свойство `show` в определениях параметров для указания, когда параметр должен быть видимым. Система оценивает эти условия в реальном времени при изменении пользователем значений полей.

### Базовый синтаксис

```javascript
{
    name: 'parameterName',
    label: 'Parameter Label',
    type: 'string',
    additionalParams: true,
    show: {
        'inputs.fieldName': ['value1', 'value2']
    }
}
```

### Поддерживаемые типы условий

#### Условие одиночного значения
```javascript
show: {
    'inputs.componentType': ['render']
}
```
Показывает параметр только когда `componentType` равен `'render'`.

#### Условие множественных значений (логика ИЛИ)
```javascript
show: {
    'inputs.objectType': ['sphere', 'cylinder']
}
```
Показывает параметр когда `objectType` равен либо `'sphere'` ИЛИ `'cylinder'`.

#### Булево условие
```javascript
show: {
    'inputs.fog': [true]
}
```
Показывает параметр только когда `fog` равен `true`.

#### Устаревший синтаксис data (совместимость)
```javascript
show: {
    'data.cameraType': ['perspective']
}
```
Альтернативный синтаксис для обратной совместимости.

## UPDL-узлы с условными параметрами

### Узел Component

Узел Component демонстрирует наиболее обширное использование условных параметров:

#### Параметры компонента Render
- **primitive** - Показывается для `componentType: 'render'`
- **color** - Показывается для `componentType: 'render'`

#### Параметры компонента Script
- **scriptName** - Показывается для `componentType: 'script'`

#### Параметры компонентов Space MMO
- **maxCapacity, currentLoad** - Показываются для `componentType: 'inventory'`
- **fireRate, damage** - Показываются для `componentType: 'weapon'`
- **pricePerTon, interactionRange** - Показываются для `componentType: 'trading'`
- **resourceType, maxYield, asteroidVolume, hardness** - Показываются для `componentType: 'mineable'`
- **targetWorld, cooldownTime** - Показываются для `componentType: 'portal'`

### Узел Object

Параметры, специфичные для формы, показываются на основе выбранного типа объекта:

- **width** - Показывается для `objectType: ['box', 'plane']`
- **height** - Показывается для `objectType: ['box', 'plane', 'cylinder']`
- **depth** - Показывается для `objectType: ['box']`
- **radius** - Показывается для `objectType: ['sphere', 'cylinder']`

### Узел Space

Параметры, специфичные для окружения:

- **fogDensity** - Показывается только когда `fog: true`

### Узел Light

Параметры, специфичные для типа света:

- **positionZ, castShadow** - Показываются для `lightType: ['point', 'directional']`
- **groundColor** - Показывается для `lightType: ['hemisphere']`

### Узел Action

Параметры, специфичные для типа действия:

- **vector, duration** - Показываются для `actionType: ['move', 'rotate']`
- **dataKey, dataValue** - Показываются для `actionType: ['setData']`
- **amount** - Показывается для `actionType: ['mine', 'trade', 'addToInventory', 'removeFromInventory']`
- **targetWorldId** - Показывается для `actionType: ['travel']`
- **stationId** - Показывается для `actionType: ['dock', 'undock']`

### Узел Data

Параметры, специфичные для типа данных:

- **isCorrect** - Показывается для `dataType: ['answer']`
- **nextSpace** - Показывается для `dataType: ['transition', 'answer']`
- **userInputType** - Показывается для `dataType: ['intro', 'transition']`
- **pointsValue** - Показывается когда `enablePoints: true`

### Узел Camera

Параметры, специфичные для типа камеры:

- **fieldOfView** - Показывается для `cameraType: ['perspective']`

## Детали реализации

### Техническая архитектура

Система условного отображения реализована с использованием централизованной функции `shouldShowInputParam()`, которая:

1. Оценивает условия `show` для каждого параметра
2. Поддерживает синтаксис как `inputs.fieldName`, так и `data.fieldName`
3. Обрабатывает условия массивов и одиночных значений
4. Обеспечивает обновления в реальном времени при изменении значений полей

### Интеграция с UI

Система интегрируется с двумя основными UI-компонентами:

1. **CanvasNode** - Контролирует видимость кнопки "Flow Control"
2. **AdditionalParamsDialog** - Фильтрует параметры, показываемые в диалоге

### Соображения производительности

- Условия оцениваются в реальном времени без влияния на производительность
- Простая булева логика обеспечивает быструю оценку
- Нет сложных вычислений или внешних зависимостей

## Лучшие практики

### Когда использовать условные параметры

Используйте условные параметры когда:
- Параметры релевантны только для определенных конфигураций
- Интерфейс становится загроможденным слишком большим количеством опций
- Разные наборы параметров применяются к разным режимам или типам

### Проектирование условий

1. **Держите условия простыми** - Используйте прямолинейное сопоставление значений
2. **Группируйте связанные параметры** - Применяйте одно и то же условие к связанным полям
3. **Используйте описательные имена полей** - Делайте условия самодокументируемыми
4. **Тестируйте все комбинации** - Убедитесь, что все комбинации параметров работают корректно

### Пример реализации

```javascript
// В определении вашего UPDL-узла
inputs: [
    {
        name: 'nodeType',
        label: 'Тип узла',
        type: 'options',
        options: [
            { label: 'Базовый', name: 'basic' },
            { label: 'Продвинутый', name: 'advanced' }
        ],
        default: 'basic'
    },
    {
        name: 'advancedOption1',
        label: 'Продвинутая опция 1',
        type: 'string',
        additionalParams: true,
        show: {
            'inputs.nodeType': ['advanced']
        }
    },
    {
        name: 'advancedOption2',
        label: 'Продвинутая опция 2',
        type: 'number',
        additionalParams: true,
        show: {
            'inputs.nodeType': ['advanced']
        }
    }
]
```

## Устранение неполадок

### Распространенные проблемы

1. **Параметры не скрываются/показываются**
   - Проверьте, что имя поля в условии точно совпадает
   - Убедитесь, что установлено `additionalParams: true`
   - Убедитесь, что значения условий совпадают с фактическими значениями полей

2. **Условие не обновляется**
   - Подтвердите, что контролирующее поле вызывает обновления UI
   - Проверьте опечатки в синтаксисе условия `show`

3. **Множественные условия не работают**
   - Помните, что множественные условия используют логику И
   - Используйте значения массива для логики ИЛИ в рамках одного условия

### Советы по отладке

1. Используйте инструменты разработчика браузера для проверки структуры данных узла
2. Проверьте, что значения полей соответствуют ожидаемым типам (string, boolean, number)
3. Убедитесь, что синтаксис условия `show` корректен

## Будущие улучшения

Система условных параметров может быть расширена в будущем для поддержки:

- Сложной логики И/ИЛИ между множественными условиями
- Вычисляемых условий на основе выражений
- Зависимостей между узлами
- Динамической оценки условий на основе внешних данных

Эта система обеспечивает мощную основу для создания интуитивных и контекстно-зависимых пользовательских интерфейсов в UPDL-узлах.
