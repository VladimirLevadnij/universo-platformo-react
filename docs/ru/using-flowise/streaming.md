---
description: –£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –≤ Flowise
---

# –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞

> **üìã –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**: –î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Flowise –∏ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –¥–ª—è Universo Platformo React. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–¥–µ–ª—ã –º–æ–≥—É—Ç –≤—Å–µ –µ—â–µ —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Flowise, –∫–æ—Ç–æ—Ä–∞—è –µ—â–µ –Ω–µ –±—ã–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Universo Platformo.

> **üîÑ –°—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤–æ–¥–∞**: –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø–µ—Ä–µ–≤–µ–¥–µ–Ω —Å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –¥–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏. –ï—Å–ª–∏ –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ –ø–µ—Ä–µ–≤–æ–¥–µ –∏–ª–∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

–ï—Å–ª–∏ –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è, —Ç–æ–∫–µ–Ω—ã –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∫–∞–∫ [server-sent events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events#Event_stream_format) —Ç–æ–ª—å–∫–æ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ –º–µ—Ä–µ –∏—Ö –ø–æ—è–≤–ª–µ–Ω–∏—è.

## –ß—Ç–æ —Ç–∞–∫–æ–µ –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞?

–ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ (streaming) - —ç—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –æ—Ç AI –º–æ–¥–µ–ª–∏ –ø–æ —á–∞—Å—Ç—è–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- **–õ—É—á—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –æ—Ç–≤–µ—Ç –ø–æ –º–µ—Ä–µ –µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **–°–Ω–∏–∂–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ–º–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏** - –æ—Ç–≤–µ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–µ—Ä–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ Python/TypeScript

Flowise –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 2 –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

* [Python](https://pypi.org/project/flowise/): `pip install flowise`
* [TypeScript](https://www.npmjs.com/package/flowise-sdk): `npm install flowise-sdk`

### Python SDK

{% tabs %}
{% tab title="Python" %}
```python
from flowise import Flowise, PredictionData

def test_streaming():
    client = Flowise()

    # –¢–µ—Å—Ç –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
    completion = client.create_prediction(
        PredictionData(
            canvasId="<flow-id>",
            question="–†–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç!",
            streaming=True
        )
    )

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≤—ã–≤–æ–¥ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞
    print("–ü–æ—Ç–æ–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç:")
    for chunk in completion:
        # {event: "token", data: "–ø—Ä–∏–≤–µ—Ç"}
        print(chunk)

if __name__ == "__main__":
    test_streaming()
```
{% endtab %}

{% tab title="TypeScript" %}
```javascript
import { FlowiseClient } from 'flowise-sdk'

async function test_streaming() {
  const client = new FlowiseClient({ baseUrl: 'http://localhost:3000' });

  try {
    // –î–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
    const prediction = await client.createPrediction({
      canvasId: '<flow-id>',
      question: '–ö–∞–∫–∞—è —Å—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏?',
      streaming: true,
    });

    for await (const chunk of prediction) {
      // {event: "token", data: "–ü–∞—Ä–∏–∂"}
      console.log(chunk);
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error);
  }
}

test_streaming();
```
{% endtab %}
{% endtabs %}

## –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏

```javascript
// JavaScript/Node.js
async function streamingRequest() {
    const response = await fetch('http://localhost:3000/api/v1/prediction/your-canvas-id', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            question: "–ù–∞–ø–∏—à–∏ –¥–ª–∏–Ω–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –æ –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö",
            streaming: true
        })
    });

    const reader = response.body.getReader();
    const decoder = new TextDecoder();

    while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split('\n');

        for (const line of lines) {
            if (line.startsWith('data: ')) {
                const data = line.slice(6);
                if (data === '[DONE]') {
                    console.log('\n–ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                    return;
                }
                
                try {
                    const parsed = JSON.parse(data);
                    process.stdout.write(parsed.text || '');
                } catch (e) {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
                }
            }
        }
    }
}
```

### Python —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

```python
import requests
import json
import time

def streaming_request_with_error_handling():
    url = "http://localhost:3000/api/v1/prediction/your-canvas-id"
    data = {
        "question": "–û–±—ä—è—Å–Ω–∏ –∫–≤–∞–Ω—Ç–æ–≤—É—é –º–µ—Ö–∞–Ω–∏–∫—É –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏",
        "streaming": True
    }
    
    try:
        response = requests.post(url, json=data, stream=True, timeout=60)
        response.raise_for_status()
        
        print("–ù–∞—á–∞–ª–æ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏...")
        
        for line in response.iter_lines(decode_unicode=True):
            if line:
                if line.startswith('data: '):
                    data_part = line[6:]  # –£–±–∏—Ä–∞–µ–º 'data: '
                    
                    if data_part == '[DONE]':
                        print("\n\n–ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
                        break
                    
                    try:
                        parsed = json.loads(data_part)
                        text = parsed.get('text', '')
                        if text:
                            print(text, end='', flush=True)
                    except json.JSONDecodeError:
                        continue
                        
    except requests.exceptions.Timeout:
        print("–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è")
    except requests.exceptions.RequestException as e:
        print(f"–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: {e}")
    except KeyboardInterrupt:
        print("\n–ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
```

## –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏

### 1. –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤

```python
class StreamBuffer:
    def __init__(self, chunk_size=50):
        self.buffer = ""
        self.chunk_size = chunk_size
        self.complete_sentences = []
    
    def add_text(self, text):
        self.buffer += text
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        while '.' in self.buffer or '!' in self.buffer or '?' in self.buffer:
            # –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω–µ—Ü –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
            end_indices = [
                self.buffer.find('.'),
                self.buffer.find('!'),
                self.buffer.find('?')
            ]
            end_indices = [i for i in end_indices if i != -1]
            
            if end_indices:
                end_pos = min(end_indices) + 1
                sentence = self.buffer[:end_pos].strip()
                if sentence:
                    self.complete_sentences.append(sentence)
                self.buffer = self.buffer[end_pos:].strip()
            else:
                break
    
    def get_complete_sentences(self):
        sentences = self.complete_sentences.copy()
        self.complete_sentences.clear()
        return sentences
    
    def get_remaining_buffer(self):
        return self.buffer

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
buffer = StreamBuffer()

def process_streaming_response():
    # ... –∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞ ...
    
    for chunk in stream:
        if chunk.get('text'):
            buffer.add_text(chunk['text'])
            
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
            sentences = buffer.get_complete_sentences()
            for sentence in sentences:
                print(f"–ó–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: {sentence}")
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –±—É—Ñ–µ—Ä–∞
    remaining = buffer.get_remaining_buffer()
    if remaining:
        print(f"–û—Å—Ç–∞–≤—à–∏–π—Å—è —Ç–µ–∫—Å—Ç: {remaining}")
```

### 2. –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

```python
def enhanced_streaming():
    url = "http://localhost:3000/api/v1/prediction/your-canvas-id"
    data = {
        "question": "–°–æ–∑–¥–∞–π –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω –ø—Ä–æ–µ–∫—Ç–∞",
        "streaming": True,
        "overrideConfig": {
            "returnSourceDocuments": True,
            "returnIntermediateSteps": True
        }
    }
    
    response = requests.post(url, json=data, stream=True)
    
    current_step = None
    accumulated_text = ""
    
    for line in response.iter_lines(decode_unicode=True):
        if line and line.startswith('data: '):
            data_part = line[6:]
            
            if data_part == '[DONE]':
                break
            
            try:
                parsed = json.loads(data_part)
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
                event_type = parsed.get('event', 'token')
                
                if event_type == 'token':
                    text = parsed.get('text', '')
                    accumulated_text += text
                    print(text, end='', flush=True)
                
                elif event_type == 'step':
                    step_info = parsed.get('data', {})
                    current_step = step_info.get('step')
                    print(f"\n[–®–∞–≥: {current_step}]")
                
                elif event_type == 'source':
                    sources = parsed.get('data', [])
                    print(f"\n[–ò—Å—Ç–æ—á–Ω–∏–∫–∏: {len(sources)} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤]")
                
                elif event_type == 'error':
                    error_msg = parsed.get('data', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')
                    print(f"\n[–û—à–∏–±–∫–∞: {error_msg}]")
                    
            except json.JSONDecodeError:
                continue
    
    return accumulated_text
```

### 3. –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ —Ñ–∞–π–ª

```python
import os
from datetime import datetime

def streaming_to_file():
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"streaming_output_{timestamp}.txt"
    
    url = "http://localhost:3000/api/v1/prediction/your-canvas-id"
    data = {
        "question": "–ù–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç—å—é –æ –º–∞—à–∏–Ω–Ω–æ–º –æ–±—É—á–µ–Ω–∏–∏",
        "streaming": True
    }
    
    response = requests.post(url, json=data, stream=True)
    
    with open(filename, 'w', encoding='utf-8') as file:
        print(f"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –≤ —Ñ–∞–π–ª: {filename}")
        
        for line in response.iter_lines(decode_unicode=True):
            if line and line.startswith('data: '):
                data_part = line[6:]
                
                if data_part == '[DONE]':
                    break
                
                try:
                    parsed = json.loads(data_part)
                    text = parsed.get('text', '')
                    
                    if text:
                        # –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
                        print(text, end='', flush=True)
                        
                        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª
                        file.write(text)
                        file.flush()  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å
                        
                except json.JSONDecodeError:
                    continue
    
    print(f"\n\n–ü–æ—Ç–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ñ–∞–π–ª: {filename}")
    return filename
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏–π

```python
# –¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π –≤ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–µ
EVENT_TYPES = {
    'token': '–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω',
    'start': '–ù–∞—á–∞–ª–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏',
    'end': '–ö–æ–Ω–µ—Ü –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏', 
    'error': '–û—à–∏–±–∫–∞',
    'step': '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —à–∞–≥',
    'source': '–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö',
    'metadata': '–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ'
}

def handle_streaming_events():
    for line in response.iter_lines(decode_unicode=True):
        if line and line.startswith('data: '):
            data_part = line[6:]
            
            if data_part == '[DONE]':
                handle_stream_end()
                break
            
            try:
                event = json.loads(data_part)
                event_type = event.get('event', 'token')
                
                if event_type == 'token':
                    handle_token(event.get('data', ''))
                elif event_type == 'start':
                    handle_stream_start(event.get('data', {}))
                elif event_type == 'error':
                    handle_stream_error(event.get('data', {}))
                elif event_type == 'step':
                    handle_intermediate_step(event.get('data', {}))
                elif event_type == 'source':
                    handle_source_documents(event.get('data', []))
                elif event_type == 'metadata':
                    handle_metadata(event.get('data', {}))
                    
            except json.JSONDecodeError as e:
                print(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: {e}")

def handle_token(text):
    print(text, end='', flush=True)

def handle_stream_start(data):
    print(f"[–ù–∞—á–∞–ª–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {data.get('timestamp')}]")

def handle_stream_end():
    print("\n[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞]")

def handle_stream_error(error_data):
    print(f"\n[–û—à–∏–±–∫–∞: {error_data.get('message', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')}]")

def handle_intermediate_step(step_data):
    step_name = step_data.get('step', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —à–∞–≥')
    print(f"\n[–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è: {step_name}]")

def handle_source_documents(sources):
    print(f"\n[–ù–∞–π–¥–µ–Ω–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤: {len(sources)}]")
    for i, source in enumerate(sources[:3]):  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3
        title = source.get('metadata', {}).get('title', f'–î–æ–∫—É–º–µ–Ω—Ç {i+1}')
        print(f"  - {title}")

def handle_metadata(metadata):
    tokens_used = metadata.get('tokens_used', 0)
    model = metadata.get('model', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')
    print(f"\n[–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: –ú–æ–¥–µ–ª—å={model}, –¢–æ–∫–µ–Ω–æ–≤={tokens_used}]")
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –ü—É–ª–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

```python
import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

class OptimizedStreamingClient:
    def __init__(self, base_url, max_retries=3):
        self.base_url = base_url
        self.session = requests.Session()
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ retry —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
        retry_strategy = Retry(
            total=max_retries,
            backoff_factor=1,
            status_forcelist=[429, 500, 502, 503, 504],
        )
        
        adapter = HTTPAdapter(max_retries=retry_strategy)
        self.session.mount("http://", adapter)
        self.session.mount("https://", adapter)
    
    def stream_prediction(self, canvas_id, question, **kwargs):
        url = f"{self.base_url}/api/v1/prediction/{canvas_id}"
        data = {
            "question": question,
            "streaming": True,
            **kwargs
        }
        
        response = self.session.post(url, json=data, stream=True, timeout=60)
        response.raise_for_status()
        
        return self._process_stream(response)
    
    def _process_stream(self, response):
        for line in response.iter_lines(decode_unicode=True):
            if line and line.startswith('data: '):
                data_part = line[6:]
                
                if data_part == '[DONE]':
                    break
                
                try:
                    yield json.loads(data_part)
                except json.JSONDecodeError:
                    continue

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
client = OptimizedStreamingClient("http://localhost:3000")

for event in client.stream_prediction("your-canvas-id", "–†–∞—Å—Å–∫–∞–∂–∏ –æ Python"):
    if event.get('text'):
        print(event['text'], end='', flush=True)
```

### 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
import asyncio
import aiohttp
import json

async def async_streaming_request():
    url = "http://localhost:3000/api/v1/prediction/your-canvas-id"
    data = {
        "question": "–û–±—ä—è—Å–Ω–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ",
        "streaming": True
    }
    
    async with aiohttp.ClientSession() as session:
        async with session.post(url, json=data) as response:
            async for line in response.content:
                line_str = line.decode('utf-8').strip()
                
                if line_str.startswith('data: '):
                    data_part = line_str[6:]
                    
                    if data_part == '[DONE]':
                        break
                    
                    try:
                        event = json.loads(data_part)
                        text = event.get('text', '')
                        if text:
                            print(text, end='', flush=True)
                    except json.JSONDecodeError:
                        continue

# –ó–∞–ø—É—Å–∫
asyncio.run(async_streaming_request())
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –≤ Flowise –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–ª–∏—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –∑–∞ —Å—á–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫, –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–∑—ã–≤—á–∏–≤—ã–µ –∏ –Ω–∞–¥–µ–∂–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏:
- **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –≤—Å–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π** –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **–†–µ–∞–ª–∏–∑—É–π—Ç–µ graceful error handling** –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞
- **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö** –≤–∫–ª—é—á–∞—è –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
