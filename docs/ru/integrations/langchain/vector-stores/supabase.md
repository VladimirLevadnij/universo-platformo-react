# Supabase

> **üìã –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**: –î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Flowise –∏ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –¥–ª—è Universo Platformo React. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–¥–µ–ª—ã –º–æ–≥—É—Ç –≤—Å–µ –µ—â–µ —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Flowise, –∫–æ—Ç–æ—Ä–∞—è –µ—â–µ –Ω–µ –±—ã–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Universo Platformo.

> **üîÑ –°—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤–æ–¥–∞**: –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø–µ—Ä–µ–≤–µ–¥–µ–Ω —Å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –¥–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏. –ï—Å–ª–∏ –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ –ø–µ—Ä–µ–≤–æ–¥–µ –∏–ª–∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –≤ [Supabase](https://supabase.com/)
2. –ù–∞–∂–º–∏—Ç–µ **New project**

<figure><img src="../../../.gitbook/assets/image (8) (2) (1).png" alt=""><figcaption></figcaption></figure>

3. –í–≤–µ–¥–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

| –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è             | –û–ø–∏—Å–∞–Ω–∏–µ                                          |
| ------------------------- | ------------------------------------------------- |
| **Name**                  | –∏–º—è —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Flowise)     |
| **Database** **Password** | –ø–∞—Ä–æ–ª—å –∫ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö postgres              |

<figure><img src="../../../.gitbook/assets/image (25) (1) (1).png" alt=""><figcaption></figcaption></figure>

4. –ù–∞–∂–º–∏—Ç–µ **Create new project** –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
5. –ù–∞–∂–º–∏—Ç–µ **SQL Editor**

<figure><img src="../../../.gitbook/assets/image (7) (2) (2).png" alt=""><figcaption></figcaption></figure>

6. –ù–∞–∂–º–∏—Ç–µ **New query**

<figure><img src="../../../.gitbook/assets/image (36) (1).png" alt=""><figcaption></figcaption></figure>

7. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π –Ω–∏–∂–µ SQL –∑–∞–ø—Ä–æ—Å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ —Å –ø–æ–º–æ—â—å—é `Ctrl + Enter` –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ **RUN**. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –∏ –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏.

* **–ò–º—è —Ç–∞–±–ª–∏—Ü—ã**: `documents`
* **–ò–º—è –∑–∞–ø—Ä–æ—Å–∞**: `match_documents`

```plsql
-- –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
create extension vector;

-- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
create table documents (
  id bigserial primary key,
  content text, -- —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Document.pageContent
  metadata jsonb, -- —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Document.metadata
  embedding vector(1536) -- 1536 —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ OpenAI, –∏–∑–º–µ–Ω–∏—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
);

-- –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
create function match_documents (
  query_embedding vector(1536),
  match_count int DEFAULT null,
  filter jsonb DEFAULT '{}'
) returns table (
  id bigint,
  content text,
  metadata jsonb,
  similarity float
)
language plpgsql
as $$
#variable_conflict use_column
begin
  return query
  select
    id,
    content,
    metadata,
    1 - (documents.embedding <=> query_embedding) as similarity
  from documents
  where metadata @> filter
  order by documents.embedding <=> query_embedding
  limit match_count;
end;
$$;

```

–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–ø–∏—Å–µ–π](../record-managers.md) –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–æ–∫ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è. –ü–æ—Å–∫–æ–ª—å–∫—É –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–ø–∏—Å–µ–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π UUID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞, –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å—É—â–Ω–æ—Å—Ç—å —Å—Ç–æ–ª–±—Ü–∞ id –Ω–∞ text:

```sql
-- –í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
create extension vector;

-- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∞—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
create table documents (
  id text primary key, -- –ò–ó–ú–ï–ù–ò–¢–¨ –ù–ê TEXT
  content text,
  metadata jsonb,
  embedding vector(1536)
);

-- –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
create function match_documents (
  query_embedding vector(1536),
  match_count int DEFAULT null,
  filter jsonb DEFAULT '{}'
) returns table (
  id text, -- –ò–ó–ú–ï–ù–ò–¢–¨ –ù–ê TEXT
  content text,
  metadata jsonb,
  similarity float
)
language plpgsql
as $$
#variable_conflict use_column
begin
  return query
  select
    id,
    content,
    metadata,
    1 - (documents.embedding <=> query_embedding) as similarity
  from documents
  where metadata @> filter
  order by documents.embedding <=> query_embedding
  limit match_count;
end;
$$;

```

<figure><img src="../../../.gitbook/assets/image (19) (1) (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. –ù–∞–∂–º–∏—Ç–µ **Project Settings**

<figure><img src="../../../.gitbook/assets/image (30) (1).png" alt=""><figcaption></figcaption></figure>

2. –ü–æ–ª—É—á–∏—Ç–µ –≤–∞—à **Project URL & API Key**

<figure><img src="../../../.gitbook/assets/image (2) (3).png" alt=""><figcaption></figcaption></figure>

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∂–¥—É—é –¥–µ—Ç–∞–ª—å (_API –∫–ª—é—á, URL, –∏–º—è —Ç–∞–±–ª–∏—Ü—ã, –∏–º—è –∑–∞–ø—Ä–æ—Å–∞_) –≤ —É–∑–µ–ª **Supabase**

<figure><img src="../../../.gitbook/assets/image (85).png" alt="" width="331"><figcaption></figcaption></figure>

4. **Document** –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –ª—é–±–æ–º—É —É–∑–ª—É –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ [**Document Loader**](../document-loaders/)
5. **Embeddings** –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –ª—é–±–æ–º—É —É–∑–ª—É –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ [**Embeddings**](../embeddings/)

## –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è

–î–æ–ø—É—Å—Ç–∏–º, —É –≤–∞—Å –µ—Å—Ç—å —Ä–∞–∑–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ–¥ –∫–ª—é—á–æ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö `{source}`

<figure><img src="../../../.gitbook/assets/Untitled.png" alt=""><figcaption></figcaption></figure>

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:

**UI**

<figure><img src="../../../.gitbook/assets/image (9) (1) (1) (1) (1) (2) (1).png" alt="" width="232"><figcaption></figcaption></figure>

**API**

```json
"overrideConfig": {
    "supabaseMetadataFilter": {
        "source": "henry"
    }
}
```

## –†–µ—Å—É—Ä—Å—ã

* [LangChain JS Supabase](https://js.langchain.com/docs/modules/indexes/vector_stores/integrations/supabase)
* [–ü–æ—Å—Ç –≤ –±–ª–æ–≥–µ Supabase](https://supabase.com/blog/openai-embeddings-postgres-vector)
* [–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö](https://js.langchain.com/docs/integrations/vectorstores/supabase#metadata-filtering)
