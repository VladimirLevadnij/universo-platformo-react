# UPDL (Lenguaje Universal de DefiniciÃ³n de Plataformas)

> **ðŸ“‹ Aviso**: Esta documentaciÃ³n estÃ¡ basada en la documentaciÃ³n original de Flowise y actualmente se estÃ¡ adaptando para Universo Platformo React. Algunas secciones pueden aÃºn hacer referencia a funcionalidades de Flowise que no han sido completamente actualizadas para las caracterÃ­sticas especÃ­ficas de Universo Platformo.

Sistema de definiciones de nodos para crear espacios universales 3D/AR/VR en Flowise.

## DescripciÃ³n

UPDL proporciona un conjunto de definiciones de nodos especializadas para el editor Flowise, permitiendo a los usuarios crear descripciones abstractas de alto nivel de espacios 3D. Estas descripciones pueden luego ser exportadas a varias tecnologÃ­as (AR.js, PlayCanvas y otras) a travÃ©s de aplicaciones de publicaciÃ³n.

## Arquitectura

UPDL es un mÃ³dulo puro de definiciones de nodos que se integra perfectamente con Flowise:

- **Solo Definiciones de Nodos**: Contiene Ãºnicamente definiciones de clases de nodos de Flowise
- **Sin LÃ³gica de ExportaciÃ³n**: Toda la funcionalidad de construcciÃ³n de espacios y exportaciÃ³n es manejada por el sistema de publicaciÃ³n
- **IntegraciÃ³n Limpia**: Se carga en Flowise a travÃ©s del mecanismo `NodesPool` desde el directorio `dist/nodes`
- **Dependencias MÃ­nimas**: Solo contiene dependencias requeridas para definiciones de nodos

## Estructura del Proyecto

El cÃ³digo fuente tiene una estructura modular, con cada nodo de alto nivel en su propio directorio:

```
packages/updl/base/src/
â”œâ”€â”€ assets/              # Recursos estÃ¡ticos (iconos)
â”‚   â””â”€â”€ icons/
â”œâ”€â”€ i18n/                # Recursos de internacionalizaciÃ³n
â”œâ”€â”€ interfaces/          # Interfaces TypeScript principales para el ecosistema UPDL
â”‚   â””â”€â”€ UPDLInterfaces.ts
â”œâ”€â”€ nodes/               # Definiciones de nodos UPDL
â”‚   â”œâ”€â”€ action/          # ActionNode: ejecuta una acciÃ³n de juego
â”‚   â”œâ”€â”€ base/            # BaseUPDLNode: clase base compartida para todos los nodos UPDL
â”‚   â”œâ”€â”€ camera/          # CameraNode: define el punto de vista
â”‚   â”œâ”€â”€ component/       # ComponentNode: adjunta comportamiento a una Entity
â”‚   â”œâ”€â”€ data/            # DataNode: almacenamiento de datos clave-valor
â”‚   â”œâ”€â”€ entity/          # EntityNode: representa un objeto de juego en tiempo de ejecuciÃ³n
â”‚   â”œâ”€â”€ event/           # EventNode: dispara acciones basadas en eventos
â”‚   â”œâ”€â”€ light/           # LightNode: define iluminaciÃ³n para el espacio
â”‚   â”œâ”€â”€ object/          # ObjectNode (Heredado): define un objeto 3D simple
â”‚   â”œâ”€â”€ space/           # SpaceNode: el contenedor raÃ­z para una escena
â”‚   â”œâ”€â”€ universo/        # UniversoNode: configuraciones globales para MMOOMM
â”‚   â””â”€â”€ interfaces.ts    # Interfaces comunes para nodos
â””â”€â”€ index.ts             # Punto de entrada principal - exporta todas las clases de nodos e interfaces
```

## IntegraciÃ³n de Nodos

El mÃ³dulo UPDL proporciona definiciones de nodos que se integran con el editor Flowise.

### Tipos de Nodos Soportados

El sistema UPDL estÃ¡ construido alrededor de **7 nodos principales de alto nivel** que proporcionan un marco completo para describir experiencias interactivas 3D/AR/VR:

| Nodo          | PropÃ³sito                                                        | Campos Clave                           |
| ------------- | ---------------------------------------------------------------- | -------------------------------------- |
| **Space**     | Contenedores de escena/pantalla. Pueden ser anidados             | id, type (root/module/block), settings |
| **Entity**    | Objeto/actor posicionado dentro del Espacio                      | transform, tags                        |
| **Component** | AÃ±ade datos/comportamiento a Entity (render, sonido, script)     | type, props                            |
| **Event**     | Disparador (OnStart, OnClick, OnTimer...)                        | eventType, source                      |
| **Action**    | Ejecutor (Move, PlaySound, SetData...)                           | actionType, target, params             |
| **Data**      | Almacenamiento de valores; Ã¡mbito como Local, Space, Global      | key, scope, value                      |
| **Universo**  | Puerta de enlace a la red global Kiberplano (GraphQL, MQTT UNS, OPC UA) | transports, discovery, security        |

### Soporte de Nodos UPDL Principales

El sistema de plantillas estÃ¡ diseÃ±ado principalmente para procesar los 7 nodos principales de alto nivel de UPDL:

- **Space**: Contenedores de escena/pantalla
- **Entity**: Objetos/actores posicionados
- **Component**: Adjuntos de comportamiento/datos
- **Event**: Disparadores (OnStart, OnClick, etc.)
- **Action**: Ejecutores (Move, PlaySound, etc.)
- **Data**: Almacenamiento clave-valor
- **Universo**: Conectividad de red global

**Nota**: Otros nodos (Object, Camera, Light) son nodos heredados/de prueba y pueden ser significativamente cambiados o eliminados en versiones futuras. Enfoque el desarrollo en los 7 nodos principales.

### Relaciones de Nodos

En una escena tÃ­pica, las **Entities** actÃºan como contenedores para **Components** que aÃ±aden comportamiento o elementos visuales. Los **Events** adjuntos a una Entity disparan **Actions** cuando ocurren ciertas condiciones. Esta cadena `Entity â†’ Component â†’ Event â†’ Action` define la lÃ³gica interactiva del espacio.

## GuÃ­a de ImplementaciÃ³n de Conectores

Para asegurar que los nodos se conecten correctamente en el lienzo de Flowise, siga estas reglas:

1. **Conectores de Entrada**: Para permitir que un nodo padre acepte un nodo hijo, defina la conexiÃ³n en el array `inputs` de la clase del nodo padre. El `type` en la definiciÃ³n de entrada debe coincidir con el `name` del nodo hijo (ej., `type: 'UPDLEntity'`).

2. **Conectores de Salida**: Para obtener un conector de salida estÃ¡ndar, simplemente asegÃºrese de que el array `outputs` en la clase del nodo estÃ© vacÃ­o (`this.outputs = [];`). Flowise lo generarÃ¡ automÃ¡ticamente. **No** intente aÃ±adir una salida por defecto en una clase base, ya que esto romperÃ¡ el mecanismo.

3. **Nodos Terminales**: Para nodos como `ActionNode` que se configuran internamente y no se conectan a otros nodos, defina tanto `inputs` como `outputs` como arrays vacÃ­os.

## Arquitectura de Interfaces

UPDL proporciona dos niveles de interfaces TypeScript:

### Interfaces UPDL Principales (`UPDLInterfaces.ts`)
Definiciones completas del ecosistema para flujos, grafos y propiedades detalladas de nodos:

- **IUPDLFlow**: Estructura completa de flujo con nodos y aristas
- **IUPDLGraph**: RepresentaciÃ³n de grafo para procesamiento
- **IUPDLSpace**: Nodo de espacio con todas las propiedades
- **IUPDLEntity**: Nodo de entidad con transformaciÃ³n y componentes
- **IUPDLComponent**: Adjuntos y comportamientos de componentes
- **IUPDLEvent**: Disparadores y condiciones de eventos
- **IUPDLAction**: Ejecutores y parÃ¡metros de acciones
- **IUPDLData**: Almacenamiento y Ã¡mbito de datos
- **IUPDLUniverso**: ConfiguraciÃ³n de puerta de enlace de red

### Interfaces de IntegraciÃ³n (`Interface.UPDL.ts`)
Interfaces simplificadas para integraciÃ³n backend/frontend a travÃ©s del alias `@server/interface`:

- Versiones simplificadas de interfaces principales
- Optimizadas para comunicaciÃ³n API
- Complejidad reducida para escenarios de integraciÃ³n

## Proceso de ConstrucciÃ³n

El proceso de construcciÃ³n consiste en dos etapas:

1. **CompilaciÃ³n TypeScript**: Compila archivos TypeScript (`.ts`) a JavaScript (`.js`)
2. **Tareas Gulp**: Copia todos los recursos estÃ¡ticos (como iconos SVG) desde los directorios fuente a la carpeta `dist`, preservando la estructura de directorios

### Scripts Disponibles

- `pnpm clean` - Limpia el directorio `dist`
- `pnpm build` - Construye el paquete (ejecuta compilaciÃ³n TypeScript y tareas Gulp)
- `pnpm dev` - Ejecuta la construcciÃ³n en modo desarrollo con observaciÃ³n de archivos
- `pnpm lint` - Verifica el cÃ³digo con el linter

## IntegraciÃ³n con Flowise

Los nodos UPDL se integran perfectamente con la funcionalidad existente de Flowise:

- **Carga de Pool de Nodos**: Los nodos se cargan automÃ¡ticamente en Flowise a travÃ©s del mecanismo NodesPool
- **Editor Visual**: Todos los nodos aparecen en el editor visual de Flowise con iconos y conexiones apropiadas
- **Procesamiento de Flujos**: Los flujos UPDL pueden procesarse junto con flujos regulares de Flowise
- **Seguridad de Tipos**: Soporte completo de TypeScript con interfaces exhaustivas

## Ejemplos de Uso

### CreaciÃ³n de Espacio BÃ¡sico

```typescript
// Crear un espacio simple con una entidad
const spaceNode = new SpaceNode();
spaceNode.data = {
    id: "main-space",
    type: "root",
    settings: {
        physics: true,
        lighting: "dynamic"
    }
};

const entityNode = new EntityNode();
entityNode.data = {
    transform: {
        position: { x: 0, y: 0, z: 0 },
        rotation: { x: 0, y: 0, z: 0 },
        scale: { x: 1, y: 1, z: 1 }
    },
    tags: ["player", "interactive"]
};
```

### Adjunto de Componente

```typescript
// AÃ±adir comportamiento a una entidad
const componentNode = new ComponentNode();
componentNode.data = {
    type: "movement",
    props: {
        speed: 5.0,
        acceleration: 2.0
    }
};

// Conectar componente a entidad
entityNode.inputs.push({
    type: "UPDLComponent",
    node: componentNode
});
```

### Cadena Evento-AcciÃ³n

```typescript
// Crear disparador de evento
const eventNode = new EventNode();
eventNode.data = {
    eventType: "OnClick",
    source: "entity"
};

// Crear respuesta de acciÃ³n
const actionNode = new ActionNode();
actionNode.data = {
    actionType: "Move",
    target: "entity",
    params: {
        destination: { x: 10, y: 0, z: 0 },
        duration: 2.0
    }
};

// Conectar evento a acciÃ³n
eventNode.outputs.push({
    type: "UPDLAction",
    node: actionNode
});
```

## Enfoque del MÃ³dulo

Este mÃ³dulo estÃ¡ intencionalmente enfocado **solo en definiciones de nodos**:

- **Sin Constructores de Espacios**: Manejado por el sistema de publicaciÃ³n (`publish-frt`)
- **Sin LÃ³gica de ExportaciÃ³n**: Manejado por aplicaciones de publicaciÃ³n
- **Sin Clientes API**: No necesarios para definiciones de nodos
- **Sin GestiÃ³n de Estado**: Los nodos son definiciones sin estado

Esta separaciÃ³n limpia asegura arquitectura Ã³ptima y mantenibilidad.

## Directrices de Desarrollo

### AÃ±adir Nuevos Nodos

1. Crear un nuevo directorio bajo `src/nodes/`
2. Implementar la clase de nodo extendiendo `BaseUPDLNode`
3. AÃ±adir interfaces TypeScript apropiadas
4. Incluir icono SVG en `assets/icons/`
5. Exportar el nodo en `index.ts`
6. Actualizar documentaciÃ³n

### Principios de DiseÃ±o de Nodos

- **Responsabilidad Ãšnica**: Cada nodo debe tener un propÃ³sito claro
- **Composabilidad**: Los nodos deben funcionar bien juntos
- **Seguridad de Tipos**: Usar interfaces TypeScript para todas las estructuras de datos
- **Claridad Visual**: Proporcionar iconos y descripciones claras
- **DocumentaciÃ³n**: Incluir comentarios JSDoc exhaustivos

## Siguientes Pasos

- [Sistema de PublicaciÃ³n](../publish/README.md) - Aprende cÃ³mo los nodos UPDL se exportan a diferentes plataformas
- [Sistema de Nodos UPDL](../../universo-platformo/updl-nodes/README.md) - DocumentaciÃ³n detallada de cada tipo de nodo
- [Plantillas MMOOMM](../../universo-platformo/mmoomm-templates/README.md) - Plantillas pre-construidas usando nodos UPDL
