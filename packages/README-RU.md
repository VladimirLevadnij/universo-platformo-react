# Каталог приложений Universo Platformo

Здесь расположены модульные приложения, расширяющие основную платформу Flowise без изменения её ядра.

## Текущая структура

```
packages/
├── universo-types/  # Общие TypeScript типы и интерфейсы
│   └── base/            # Основные определения типов
│       ├── src/         # Исходный код
│       │   ├── interfaces/ # UPDL и платформенные интерфейсы
│       │   └── index.ts # Точка входа
│       ├── dist/        # Скомпилированный вывод (CJS, ESM, типы)
│       ├── package.json
│       ├── tsconfig.json
│       └── README.md
├── universo-utils/  # Общие утилиты и процессоры
│   └── base/            # Основные утилитарные функции
│       ├── src/         # Исходный код
│       │   ├── updl/    # Утилиты обработки UPDL (UPDLProcessor)
│       │   └── index.ts # Точка входа
│       ├── dist/        # Скомпилированный вывод (CJS, ESM, типы)
│       ├── package.json
│       ├── tsconfig.json
│       └── README.md
├── template-quiz/       # Пакет шаблона AR.js квизов
│   └── base/            # Функциональность шаблона квизов
│       ├── src/         # Исходный код
│       │   ├── arjs/    # AR.js специфичные реализации
│       │   └── index.ts # Точка входа
│       ├── dist/        # Скомпилированный вывод (CJS, ESM, типы)
│       ├── package.json
│       ├── tsconfig.json
│       └── README.md
├── template-mmoomm/     # Пакет шаблона PlayCanvas MMOOMM
│   └── base/            # Функциональность шаблона MMOOMM
│       ├── src/         # Исходный код
│       │   ├── playcanvas/ # PlayCanvas специфичные реализации
│       │   └── index.ts # Точка входа
│       ├── dist/        # Скомпилированный вывод (CJS, ESM, типы)
│       ├── package.json
│       ├── tsconfig.json
│       └── README.md
├── updl/                # Система узлов UPDL для создания 3D/AR/VR‑пространств
│   └── base/            # Ключевая функциональность UPDL
│       └── ...
├── uniks-frt/           # Фронтенд управления рабочими пространствами
│   └── base/            # Ключевая функциональность рабочих пространств
│       ├── src/
│       │   ├── i18n/    # Интернационализация
│       │   ├── pages/   # Компоненты страниц (UnikList, UnikDetail, UnikDialog)
│       │   ├── menu-items/ # Конфигурации меню
│       │   └── index.ts
│       └── ...
├── uniks-srv/           # Бекенд управления рабочими пространствами (workspace-пакет)
│   └── base/            # Ключевая функциональность рабочих пространств
│       ├── src/
│       │   ├── routes/  # Express-роуты для CRUD операций с Uniks
│       │   ├── database/ # TypeORM сущности и миграции
│       │   ├── types/   # TypeScript декларации
│       │   └── index.ts
│       └── ...
├── profile-frt/         # Фронтенд управления профилем пользователя
│   └── base/            # Ключевая функциональность профиля
│       └── ...
├── profile-srv/         # Бекенд управления профилем (workspace-пакет)
│   └── base/            # Ключевая функциональность профиля
│       └── ...
├── publish-frt/         # Фронтенд системы публикаций для экспорта и шеринга
│   └── base/            # Ключевая функциональность фронтенда
│       ├── src/
│       │   ├── api/     # HTTP-клиенты к бекенду
│       │   ├── assets/  # Статические ресурсы (иконки, изображения)
│       │   ├── builders/# Логика обработки и конвертации UPDL
│       │   ├── ...      # Другие директории фронтенда
│       │   └── index.ts
│       └── ...
├── publish-srv/         # Бекенд системы публикаций (workspace-пакет)
│   └── base/            # Ключевая функциональность бекенда
│       ├── src/
│       │   ├── controllers/ # Контроллеры Express
│       │   ├── services/    # Бизнес-логика (напр., FlowDataService)
│       │   ├── routes/      # Асинхронные фабрики роутов
│       │   ├── types/       # Общие определения типов UPDL
│       │   └── index.ts     # Точка входа для пакета
│       └── ...
└── README.md            # Данная документация
```

## Приложения

### Общие пакеты

#### Universo Platformo Types (universo-types)

Общий пакет, содержащий все определения типов TypeScript и интерфейсы, используемые на платформе.

**Ключевые возможности:**

-   **UPDL интерфейсы**: Полные определения типов для узлов UPDL, пространств и данных потоков
-   **Платформенные типы**: Общие типы для публикаций, аутентификации и API-коммуникации
-   **Двойная система сборки**: Компилируется в CommonJS и ES модули для максимальной совместимости
-   **Пакет только типов**: Чистые определения TypeScript без runtime зависимостей

**Документация:** [packages/universo-types/base/README.md](./universo-types/base/README.md)

#### Universo Platformo Utils (universo-utils)

Общий пакет, содержащий утилитарные функции и процессоры, используемые в нескольких приложениях.

**Ключевые возможности:**

-   **UPDLProcessor**: Основной процессор для конвертации данных потоков в структуры UPDL
-   **Поддержка мультисцен**: Обрабатывает как одиночные пространства, так и мультисценные UPDL потоки
-   **Агностичность к шаблонам**: Предоставляет основу для всех билдеров шаблонов
-   **Двойная система сборки**: Компилируется в CommonJS и ES модули

**Документация:** [packages/universo-utils/base/README.md](./universo-utils/base/README.md)

### Пакеты шаблонов

#### Шаблон квизов (template-quiz)

Специализированный пакет шаблонов для создания образовательных квизов AR.js со сбором лидов.

**Ключевые возможности:**

-   **Интеграция AR.js**: Полная реализация квизов AR.js с отслеживанием маркеров
-   **Мультисценные квизы**: Поддержка последовательных потоков вопросов
-   **Сбор лидов**: Встроенные формы для сбора информации о пользователях
-   **Система очков**: Автоматический подсчет очков и отображение результатов
-   **Модульная архитектура**: Отдельные обработчики для разных типов узлов UPDL

**Документация:** [packages/template-quiz/base/README.md](./template-quiz/base/README.md)

#### Шаблон MMOOMM (template-mmoomm)

Специализированный пакет шаблонов для создания космических MMO-опытов PlayCanvas.

**Ключевые возможности:**

-   **Космическая MMO-среда**: Полная 3D космическая симуляция с физикой
-   **Промышленный майнинг**: Система лазерного майнинга с автонаведением
-   **Система сущностей**: Корабли, астероиды, станции и врата
-   **Поддержка мультиплеера**: Сетевое взаимодействие в реальном времени с Colyseus
-   **Продвинутое управление**: Движение WASD+QZ с кватернионным вращением

**Документация:** [packages/template-mmoomm/base/README.md](./template-mmoomm/base/README.md)

### Uniks (Управление рабочими пространствами)

Приложение Uniks предоставляет функциональность управления рабочими пространствами, позволяя пользователям создавать, управлять и организовывать свои рабочие пространства. Оно состоит из фронтенд-приложения и бекенд workspace-пакета.

#### Uniks Frontend (uniks-frt)

**Ключевые возможности:**

-   Интерфейс создания и управления рабочими пространствами
-   Удобный список и навигация по рабочим пространствам
-   Управление участниками рабочих пространств
-   Адаптивный дизайн с компонентами Material-UI
-   Поддержка интернационализации (английский и русский языки)

**Документация:** [packages/uniks-frt/base/README.md](./uniks-frt/base/README.md)

#### Uniks Server (uniks-srv)

Это бекенд-сервис, структурированный как workspace-пакет (`@universo/uniks-srv`), отвечающий за обработку данных и операций с рабочими пространствами.

**Ключевые возможности:**

-   Express-роуты для CRUD операций с Uniks
-   TypeORM сущности (`Unik`, `UserUnik`) для управления базой данных
-   Миграции PostgreSQL базы данных
-   Интеграция с Supabase для аутентификации
-   Вложенное монтирование роутов Flowise под префиксом `/:unikId`

**Документация:** [packages/uniks-srv/base/README.md](./uniks-srv/base/README.md)

### UPDL (Universal Platform Definition Language)

Приложение UPDL предоставляет унифицированную систему узлов для описания 3D/AR/VR-пространств, которые могут быть экспортированы на множество целевых платформ. Оно определяет стандартизированный промежуточный слой представления.

#### UPDL (updl)

**Ключевые возможности:**

-   7 основных высокоуровневых узлов для описания универсальных 3D/AR/VR-сцен
-   Устаревшие узлы (Object, Camera, Light) для обратной совместимости
-   Определения и иконки для узлов
-   Чистая интеграция с Flowise
-   Интерфейсы TypeScript

**Документация:** [packages/updl/base/README.md](./updl/base/README.md)

### Profile

Приложение Profile предоставляет функциональность управления профилями пользователей. Оно состоит из фронтенд-приложения и бекенд workspace-пакета.

#### Profile Frontend (profile-frt)

**Ключевые возможности:**

-   Аутентификация на основе JWT-токенов с Supabase
-   Функциональность обновления email и пароля
-   Адаптивный дизайн для мобильных устройств

**Документация:** [packages/profile-frt/base/README.md](./profile-frt/base/README.md)

#### Profile Server (profile-srv)

Это бекенд-сервис, структурированный как workspace-пакет (`@universo/profile-srv`), отвечающий за безопасную обработку данных профиля пользователя.

**Ключевые возможности:**

-   Безопасные эндпоинты для управления данными пользователя.
-   Использование кастомных SQL-функций с `SECURITY DEFINER` для безопасного обновления данных.
-   Асинхронная инициализация роутов для предотвращения "race conditions" с подключением к БД.

**Документация:** [packages/profile-srv/base/README.md](./profile-srv/base/README.md)

### Space Builder

Приложение Space Builder преобразует текстовые запросы в граф Flow из узлов UPDL. Состоит из фронтенд‑приложения и бекенд workspace‑пакета.

#### Space Builder Frontend (space-builder-frt)

**Ключевые возможности:**

-   Генерация графа из текста (MUI диалог + FAB)
-   Выбор модели из Credentials; опциональный Test mode (через переменные окружения сервера)
-   Режимы дополнения/замены на холсте
-   Интеграция i18n и двойная сборка (CJS + ESM)

**Документация:** [packages/space-builder-frt/base/README.md](./space-builder-frt/base/README.md)

#### Space Builder Server (space-builder-srv)

Бекенд‑сервис, структурированный как workspace‑пакет (`@universo/space-builder-srv`), отвечающий за вызов LLM и безопасную выдачу JSON‑графа.

**Ключевые возможности:**

-   Эндпоинты: `/api/v1/space-builder/health`, `/config`, `/generate`
-   Мета‑промпт → вызов провайдера → извлечение RAW JSON
-   Резолв ключей через сервисы платформы
-   Валидация на базе Zod и нормализация на сервере

**Документация:** [packages/space-builder-srv/base/README.md](./space-builder-srv/base/README.md)

### Publish

Приложение Publish предоставляет механизмы для экспорта UPDL-пространств в AR.js и их публикации по публичным ссылкам.

#### Publish Frontend (publish-frt)

Фронтенд-приложение отвечает за весь пользовательский процесс публикации, включая финальную конвертацию данных в готовые для просмотра форматы AR.js и PlayCanvas.

**Ключевые возможности:**

-   **Обработка UPDL на стороне клиента**: Использует общий `UPDLProcessor` из `@universo-platformo/utils` для конвертации "сырых" `flowData` с бекенда в валидные проекты AR.js и PlayCanvas.
-   **Система реестра шаблонов**: Модульная система шаблонов, которая динамически загружает специализированные пакеты шаблонов (`@universo/template-quiz`, `@universo/template-mmoomm`).
-   **Общая система типов**: Использует `@universo-platformo/types` для согласованных определений типов во всех шаблонах и билдерах.
-   **Пакеты шаблонов**: Делегирует специфичную функциональность специализированным пакетам шаблонов для поддерживаемости и модульности.
-   **Интеграция с Supabase**: Сохраняет конфигурации публикаций.
-   **Поддержка множественных технологий**: Поддерживает AR.js квизы и PlayCanvas MMO-опыты через выделенные пакеты шаблонов.

**Документация:** [packages/publish-frt/base/README.md](./publish-frt/base/README.md)

#### Publish Backend (publish-srv)

Это бекенд-сервис, преобразованный в workspace-пакет (`@universo/publish-srv`), с единой ответственностью: предоставление данных фронтенду.

**Ключевые возможности:**

-   **Workspace-пакет**: Предоставляет общие типы и сервисы как `@universo/publish-srv`.
-   **Поставщик "сырых" данных**: Отдает `flowData` из БД, делегируя всю обработку UPDL фронтенду.
-   **Источник истины для типов**: Экспортирует все общие типы TypeScript, связанные с UPDL и публикациями.
-   **Асинхронная инициализация роутов**: Предотвращает "race conditions" путем инициализации роутов только после установки соединения с БД.

**Документация:** [packages/publish-srv/base/README.md](./publish-srv/base/README.md)

## Архитектура для будущего расширения

При расширении функциональности приложений вы можете создавать дополнительные директории, следуя этой структуре:

```
app-name/
├── base/                # Основная функциональность
│   ├── src/             # Исходный код
│   │   ├── api/         # API-клиенты (для фронтенда)
│   │   ├── assets/      # Статические ресурсы (иконки, изображения)
│   │   ├── builders/    # Билдеры из UPDL в целевые платформы (для фронтенда)
│   │   ├── components/  # React-компоненты (для фронтенда)
│   │   ├── configs/     # Конфигурационные константы
│   │   ├── controllers/ # Express-контроллеры (для бекенда)
│   │   ├── features/    # Модули функциональности (бывшие мини-приложения)
│   │   ├── hooks/       # React-хуки (для фронтенда)
│   │   ├── i18n/        # Ресурсы для интернационализации
│   │   ├── interfaces/  # TypeScript-интерфейсы и типы
│   │   ├── middlewares/ # Middleware-обработчики (для бекенда)
│   │   ├── models/      # Модели данных (для бекенда)
│   │   ├── nodes/       # Определения узлов UPDL
│   │   ├── routes/      # REST API роуты (для бекенда)
│   │   ├── services/    # Бизнес-логика (для бекенда)
│   │   ├── store/       # Управление состоянием (для фронтенда)
│   │   ├── utils/       # Утилиты
│   │   ├── validators/  # Валидация ввода (для бекенда)
│   │   └── index.ts     # Точка входа
│   ├── dist/            # Скомпилированный вывод
│   ├── package.json
│   ├── tsconfig.json
│   ├── gulpfile.ts      # (для фронтенд-модулей с ассетами)
│   └── README.md
```

**Примечание:** Не все директории обязательны для каждого приложения. Создавайте только те, которые необходимы для вашей функциональности:

-   **Фронтенд-приложениям** обычно нужны: `api/`, `assets/`, `components/`, `features/`, `pages/`, `utils/`, `gulpfile.ts`
-   **Бекенд-приложениям** обычно нужны: `controllers/`, `routes/`, `utils/`
-   **UPDL-модулям** обычно нужны: `assets/`, `interfaces/`, `nodes/`, `gulpfile.ts`

## Взаимодействия

Приложения в этой директории спроектированы для совместной работы в модульной архитектуре.

В текущей архитектуре:

```
┌──────────────┐
│              │
│   Flowise    │
│   Редактор   │
│              │
└──────┬───────┘
       │
       ▼
┌──────────────┐       ┌────────────────┐       ┌────────────────┐
│              │       │                │       │                │
│     UPDL     │──────▶│ PUBLISH-FRT    │──────▶│  PUBLISH-SRV   │
│    (Узлы)    │       │   Фронтенд     │       │     Бекенд     │
│              │       │                │       │                │
└──────────────┘       └────────────────┘       └────────┬───────┘
                                                          │
                                                          ▼
                                                 ┌────────────────┐
                                                 │                │
                                                 │ Публичный URL  │
                                                 │  /p/{uuid}     │
                                                 │                │
                                                 └────────────────┘
```

## Руководство по разработке

1.  **Модульность:** Каждое приложение должно быть самодостаточным с четкими интерфейсами.
2.  **Минимальные изменения ядра:** Избегайте модификации основной кодовой базы Flowise.
3.  **Документация:** Поддерживайте файлы README в директории каждого приложения.
4.  **Общие типы:** Используйте общие определения типов для межпрограммного взаимодействия.

## Сборка

Из корня проекта:

```bash
# Установка всех зависимостей для workspace
pnpm install

# Сборка всех приложений (и других пакетов в workspace)
pnpm build

# Сборка общих пакетов
pnpm build --filter @universo-platformo/types
pnpm build --filter @universo-platformo/utils

# Сборка пакетов шаблонов
pnpm build --filter @universo/template-quiz
pnpm build --filter @universo/template-mmoomm

# Сборка конкретного фронтенд-приложения
pnpm build --filter publish-frt
pnpm build --filter profile-frt
pnpm build --filter uniks-frt
pnpm build --filter updl

# Сборка конкретного бекенд-приложения
pnpm build --filter publish-srv
pnpm build --filter profile-srv
pnpm build --filter uniks-srv
```

## Разработка

Чтобы запустить конкретное приложение в режиме разработки (отслеживает изменения и пересобирает):

```bash
pnpm --filter publish-frt dev
pnpm --filter profile-frt dev
pnpm --filter uniks-frt dev
pnpm --filter publish-srv dev
pnpm --filter profile-srv dev
pnpm --filter uniks-srv dev
pnpm --filter updl dev
```

**Примечание о ресурсах:** Скрипты `dev` отслеживают изменения файлов TypeScript, но не копируют SVG-иконки автоматически. Если вы добавляете или изменяете SVG-ресурсы во время разработки, запустите `pnpm build --filter <app>`, чтобы они были правильно скопированы в директорию `dist`.

---

_Universo Platformo | Документация приложений_
