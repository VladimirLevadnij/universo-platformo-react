# Metaverses Frontend (metaverses-frt)

Фронтенд-приложение для управления метавселенными, секциями и сущностями в экосистеме Universo Platformo.

## Обзор

Metaverses Frontend предоставляет комплексные пользовательские сценарии для управления трёхуровневой архитектурой Метавселенные → Секции → Сущности. Пользователи могут организовывать сущности в контексте секций, поддерживать строгую изоляцию данных по метавселенным и управлять иерархическими композициями сущностей с полной валидацией и безопасностью.

## Ключевые возможности

- **Управление метавселенными**: Создание и управление метавселенными с изолированными контекстами данных
- **Управление секциями**: Организация секций внутри метавселенных с автоматической привязкой к метавселенной
- **Управление сущностями**: Создание и управление сущностями с обязательной привязкой к секции
- **Изоляция данных**: Полное разделение данных между метавселенными - сущности и секции из метавселенной A никогда не видны в метавселенной B
- **Контекстная навигация**: Навигация с учётом метавселенной с хлебными крошками и сохранением контекста в боковой панели
- **Валидация и безопасность**: Frontend и backend валидация, исключающая создание осиротевших сущностей или секций
- **Интернационализация**: Поддержка английского и русского языков с пространствами имён i18next
- **Интеграция Material-UI**: Согласованные UI компоненты с правильными индикаторами обязательных полей

## Архитектура

### Трёхуровневая модель сущностей
- **Метавселенные**: Организационные единицы верхнего уровня, обеспечивающие полную изоляцию данных
- **Секции**: Логические группировки внутри метавселенных (например, "Веб-сервисы", "Мобильные приложения")
- **Сущности**: Отдельные активы, принадлежащие конкретным секциям внутри метавселенных

### Изоляция данных
- Сущности и секции из разных метавселенных полностью изолированы
- Все операции поддерживают контекст метавселенной через URL-маршрутизацию
- Межметавселенная видимость или операции невозможны

## Структура

```
src/
├── api/              # Функции API клиента
│   ├── metaverses.ts   # CRUD метавселенных и управление секциями
│   ├── sections.ts    # CRUD операции секций
│   ├── entities.ts  # CRUD операции сущностей
│   └── index.ts      # Экспорты API
├── components/       # Переиспользуемые UI компоненты
│   └── index.ts      # Экспорты компонентов
├── hooks/            # Пользовательские React хуки
│   └── index.ts      # Экспорты хуков
├── i18n/             # Интернационализация
│   ├── locales/      # Переводы языков (en, ru)
│   └── index.ts      # Конфигурация i18n
├── pages/            # Основные компоненты страниц
│   ├── MetaverseDetail.tsx    # Детали метавселенной с вкладками секций/сущностей
│   ├── SectionDetail.tsx     # Детали секции в контексте метавселенной
│   ├── SectionDialog.tsx     # Диалог создания/редактирования секции
│   └── EntityDialog.tsx   # Диалог создания/редактирования сущности
├── menu-items/       # Конфигурация навигационного меню
│   └── metaverseDashboard.ts
├── types/            # Определения типов TypeScript
│   └── index.ts
└── index.ts          # Экспорты пакета
```

## Ключевые компоненты

### MetaverseDetail.tsx
Основной интерфейс управления метавселенной с вкладочной навигацией:
- **Обзор**: Информация о метавселенной и статистика
- **Секции**: Список секций в метавселенной с возможностями создания/редактирования
- **Сущности**: Список сущностей в метавселенной с возможностями создания/редактирования
- **Метаверсборд**: Специфичная для метавселенной панель управления и аналитика

Включает навигацию с хлебными крошками с учётом метавселенной и поддерживает контекст метавселенной во всех операциях.

### SectionDetail.tsx
Представление деталей секции в контексте метавселенной:
- Отображает информацию о секции и связанных сущностях
- Поддерживает контекст метавселенной в навигации и хлебных крошках
- Предоставляет доступ к управлению сущностями, специфичными для секции

### EntityDialog.tsx
Модальная форма для создания/редактирования сущностей со строгой валидацией:
- **Обязательный выбор секции**: Выбор секции обязателен, пустая опция отсутствует
- **Контекст метавселенной**: При открытии в контексте метавселенной показывает только секции из этой метавселенной
- **Валидация**: Frontend валидация предотвращает отправку без выбора секции
- **Интеграция Material-UI**: Правильные индикаторы обязательных полей и состояния ошибок

### SectionDialog.tsx
Модальная форма для создания/редактирования секций:
- **Привязка к метавселенной**: Автоматически связывает новые секции с текущей метавселенной
- **Валидация**: Предотвращает создание секций без привязки к метавселенной
- **Осведомлённость о контексте**: Работает в контексте метавселенной для правильной изоляции данных

## Интеграция с API

### Операции в области метавселенной
```typescript
// Получить секции для конкретной метавселенной
const sections = await getMetaverseSections(metaverseId)

// Получить сущности для конкретной метавселенной
const entities = await getMetaverseEntities(metaverseId)

// Связать секцию с метавселенной
await addSectionToMetaverse(metaverseId, sectionId)
```

### Создание сущности с валидацией
```typescript
// Создать сущность с обязательной привязкой к секции
const entity = await createEntity({
  name: 'Моя сущность',
  description: 'Описание сущности',
  sectionId: 'обязательный-id-секции',  // Обязательно
  metaverseId: 'опциональный-id-метавселенной' // Опционально для контекста метавселенной
})
```

### Создание секции с контекстом метавселенной
```typescript
// Создать секцию с обязательной привязкой к метавселенной
const section = await createSection({
  name: 'Моя секция',
  description: 'Описание секции',
  metaverseId: 'обязательный-id-метавселенной'  // Обязательно
})
```

## Разработка

### Предварительные требования
- Node.js 18+
- Менеджер пакетов PNPM

### Команды
```bash
# Установка зависимостей (из корня проекта)
pnpm install

# Сборка приложения
pnpm --filter @universo/metaverses-frt build

# Запуск тестов
pnpm --filter @universo/metaverses-frt test

# Проверка линтером
pnpm --filter @universo/metaverses-frt lint
```

### Заметки по разработке
- Все операции поддерживают контекст метавселенной через URL-маршрутизацию (`/metaverses/:metaverseId/...`)
- Выбор секции обязателен для создания сущности с правильной валидацией
- Компоненты Material-UI используют правильные атрибуты `required` для валидации форм
- Пространство имён i18next `entities` используется для всех переводов

### Заметки по безопасности
- Аутентификация API сейчас использует bearer‑токен из `localStorage` (см. `src/api/apiClient.ts`). Это приемлемо для разработки, но подвергает токен риску XSS.
- Рекомендуется миграция на HTTP‑only защищённые cookie с CSRF‑защитой и строгой CSP.

## Структура маршрутизации

Приложение использует вложенную маршрутизацию для поддержания контекста метавселенной:

```
/metaverses/:metaverseId                    # Детали метавселенной (вкладка обзора)
/metaverses/:metaverseId/sections           # Вкладка секций
/metaverses/:metaverseId/entities         # Вкладка сущностей
/metaverses/:metaverseId/metaverseboard      # Вкладка метаверсборда
/metaverses/:metaverseId/sections/:sectionId # Детали секции в метавселенной
```

Все маршруты поддерживают контекст метавселенной в хлебных крошках и боковой навигации.

## Изоляция данных и безопасность

- **Полная изоляция метавселенных**: Сущности и секции из метавселенной A никогда не видны в метавселенной B
- **Обязательные ассоциации**: Сущности должны быть связаны с секциями, секции должны быть связаны с метавселенными
- **Frontend валидация**: Валидация форм предотвращает создание осиротевших сущностей
- **Backend валидация**: Серверная валидация обеспечивает целостность данных
- **Сохранение контекста**: Навигация поддерживает контекст метавселенной на протяжении всего пользовательского пути

## Связанная документация
- [Сервис Metaverses Backend](../../../packages/metaverses-srv/base/README.md)
- [Документация приложения Metaverses](../../../docs/ru/applications/metaverses/README.md)

---

**Universo Platformo | Приложение Metaverses Frontend**
