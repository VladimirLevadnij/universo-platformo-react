# @universo-platformo/utils

Утилиты, используемые на фронтенде и бэкенде для валидации, сериализации, дельт ECS, синхронизации времени и сетевых утилит в Universo Platformo.

-   Область: Zod‑схемы для сетевых DTO (Intent/Ack/Snapshot/Delta/Event), UPDL‑схемы (passthrough), детерминированная сериализация и безопасный парсинг JSON, лёгкий хеш, вычисление/применение дельт ECS, оценка синхронизации времени (по аналогии с NTP), хелперы seq/ack, утилиты для сетевых портов.
-   Вне области: утилиты, завязанные на конкретный рантайм (только Node или только browser), фреймворк‑специфичные хелперы, криптографическое хеширование/шифрование, тяжёлые IO операции.

Правила совместимости:

-   Сохраняйте обратную совместимость публичных API; расширяйте новыми функциями/опциями вместо ломающих изменений.
-   Новые поля добавляйте как опциональные/с значениями по умолчанию для сохранения совместимости схем.
-   Импортируйте только из корня пакета (без глубоких импортов).

Установка (workspace):

-   Пакет расположен по пути `packages/universo-utils/base` и используется другими пакетами монорепозитория через `workspace:*`.

Лицензия: Omsk Open License

## Тестирование

Запустите Vitest для тестирования UPDL помощников сериализации:

```bash
pnpm --filter @universo-platformo/utils test
```

## Справочник API

### Сетевые утилиты (`net`)

**`ensurePortAvailable(port: number, host?: string): Promise<void>`**

Проверяет, доступен ли порт, пытаясь привязаться к нему. Выбрасывает ошибку, если порт уже используется.

```typescript
import { net } from '@universo-platformo/utils'

// Проверить, доступен ли порт 3000
await net.ensurePortAvailable(3000)

// Проверить с конкретным хостом
await net.ensurePortAvailable(8080, 'localhost')
```

### Синхронизация времени (`net`)

**`createTimeSyncEstimator()`**

Создает оценщик синхронизации времени (как NTP) для координации времени клиент-сервер.

### Последовательности (`net`)

**`updateSeqState()` и `reconcileAck()`**

Помощники для управления порядковыми номерами и подтверждениями в сетевых приложениях.
