# Resources Frontend (resources-frt)

Фронтенд-приложение для управления кластерами, доменами и ресурсами в экосистеме Universo Platformo.

## Обзор

Resources Frontend предоставляет комплексные пользовательские сценарии для управления трёхуровневой архитектурой Кластеры → Домены → Ресурсы. Пользователи могут организовывать ресурсы в контексте доменов, поддерживать строгую изоляцию данных по кластерам и управлять иерархическими композициями ресурсов с полной валидацией и безопасностью.

## Ключевые возможности

- **Управление кластерами**: Создание и управление кластерами ресурсов с изолированными контекстами данных
- **Управление доменами**: Организация доменов внутри кластеров с автоматической привязкой к кластеру
- **Управление ресурсами**: Создание и управление ресурсами с обязательной привязкой к домену
- **Изоляция данных**: Полное разделение данных между кластерами - ресурсы и домены из кластера A никогда не видны в кластере B
- **Контекстная навигация**: Навигация с учётом кластера с хлебными крошками и сохранением контекста в боковой панели
- **Валидация и безопасность**: Frontend и backend валидация, исключающая создание осиротевших ресурсов или доменов
- **Интернационализация**: Поддержка английского и русского языков с пространствами имён i18next
- **Интеграция Material-UI**: Согласованные UI компоненты с правильными индикаторами обязательных полей

## Архитектура

### Трёхуровневая модель сущностей
- **Кластеры**: Организационные единицы верхнего уровня, обеспечивающие полную изоляцию данных
- **Домены**: Логические группировки внутри кластеров (например, "Веб-сервисы", "Мобильные приложения")
- **Ресурсы**: Отдельные активы, принадлежащие конкретным доменам внутри кластеров

### Изоляция данных
- Ресурсы и домены из разных кластеров полностью изолированы
- Все операции поддерживают контекст кластера через URL-маршрутизацию
- Межкластерная видимость или операции невозможны

## Структура

```
src/
├── api/              # Функции API клиента
│   ├── clusters.ts   # CRUD кластеров и управление доменами
│   ├── domains.ts    # CRUD операции доменов
│   ├── resources.ts  # CRUD операции ресурсов
│   └── index.ts      # Экспорты API
├── components/       # Переиспользуемые UI компоненты
│   └── index.ts      # Экспорты компонентов
├── hooks/            # Пользовательские React хуки
│   └── index.ts      # Экспорты хуков
├── i18n/             # Интернационализация
│   ├── locales/      # Переводы языков (en, ru)
│   └── index.ts      # Конфигурация i18n
├── pages/            # Основные компоненты страниц
│   ├── ClusterDetail.tsx    # Детали кластера с вкладками доменов/ресурсов
│   ├── DomainDetail.tsx     # Детали домена в контексте кластера
│   ├── DomainDialog.tsx     # Диалог создания/редактирования домена
│   └── ResourceDialog.tsx   # Диалог создания/редактирования ресурса
├── menu-items/       # Конфигурация навигационного меню
│   └── clusterDashboard.ts
├── types/            # Определения типов TypeScript
│   └── index.ts
└── index.ts          # Экспорты пакета
```

## Ключевые компоненты

### ClusterDetail.tsx
Основной интерфейс управления кластером с вкладочной навигацией:
- **Обзор**: Информация о кластере и статистика
- **Домены**: Список доменов в кластере с возможностями создания/редактирования
- **Ресурсы**: Список ресурсов в кластере с возможностями создания/редактирования
- **Кластерборд**: Специфичная для кластера панель управления и аналитика

Включает навигацию с хлебными крошками с учётом кластера и поддерживает контекст кластера во всех операциях.

### DomainDetail.tsx
Представление деталей домена в контексте кластера:
- Отображает информацию о домене и связанных ресурсах
- Поддерживает контекст кластера в навигации и хлебных крошках
- Предоставляет доступ к управлению ресурсами, специфичными для домена

### ResourceDialog.tsx
Модальная форма для создания/редактирования ресурсов со строгой валидацией:
- **Обязательный выбор домена**: Выбор домена обязателен, пустая опция отсутствует
- **Контекст кластера**: При открытии в контексте кластера показывает только домены из этого кластера
- **Валидация**: Frontend валидация предотвращает отправку без выбора домена
- **Интеграция Material-UI**: Правильные индикаторы обязательных полей и состояния ошибок

### DomainDialog.tsx
Модальная форма для создания/редактирования доменов:
- **Привязка к кластеру**: Автоматически связывает новые домены с текущим кластером
- **Валидация**: Предотвращает создание доменов без привязки к кластеру
- **Осведомлённость о контексте**: Работает в контексте кластера для правильной изоляции данных

## Интеграция с API

### Операции в области кластера
```typescript
// Получить домены для конкретного кластера
const domains = await getClusterDomains(clusterId)

// Получить ресурсы для конкретного кластера
const resources = await getClusterResources(clusterId)

// Связать домен с кластером
await addDomainToCluster(clusterId, domainId)
```

### Создание ресурса с валидацией
```typescript
// Создать ресурс с обязательной привязкой к домену
const resource = await createResource({
  name: 'Мой ресурс',
  description: 'Описание ресурса',
  domainId: 'обязательный-id-домена',  // Обязательно
  clusterId: 'опциональный-id-кластера' // Опционально для контекста кластера
})
```

### Создание домена с контекстом кластера
```typescript
// Создать домен с обязательной привязкой к кластеру
const domain = await createDomain({
  name: 'Мой домен',
  description: 'Описание домена',
  clusterId: 'обязательный-id-кластера'  // Обязательно
})
```

## Разработка

### Предварительные требования
- Node.js 18+
- Менеджер пакетов PNPM

### Команды
```bash
# Установка зависимостей (из корня проекта)
pnpm install

# Сборка приложения
pnpm --filter @universo/resources-frt build

# Запуск тестов
pnpm --filter @universo/resources-frt test

# Проверка линтером
pnpm --filter @universo/resources-frt lint
```

### Заметки по разработке
- Все операции поддерживают контекст кластера через URL-маршрутизацию (`/clusters/:clusterId/...`)
- Выбор домена обязателен для создания ресурса с правильной валидацией
- Компоненты Material-UI используют правильные атрибуты `required` для валидации форм
- Пространство имён i18next `resources` используется для всех переводов

### Заметки по безопасности
- Аутентификация API сейчас использует bearer‑токен из `localStorage` (см. `src/api/apiClient.ts`). Это приемлемо для разработки, но подвергает токен риску XSS.
- Рекомендуется миграция на HTTP‑only защищённые cookie с CSRF‑защитой и строгой CSP.

## Структура маршрутизации

Приложение использует вложенную маршрутизацию для поддержания контекста кластера:

```
/clusters/:clusterId                    # Детали кластера (вкладка обзора)
/clusters/:clusterId/domains           # Вкладка доменов
/clusters/:clusterId/resources         # Вкладка ресурсов
/clusters/:clusterId/clusterboard      # Вкладка кластерборда
/clusters/:clusterId/domains/:domainId # Детали домена в кластере
```

Все маршруты поддерживают контекст кластера в хлебных крошках и боковой навигации.

## Изоляция данных и безопасность

- **Полная изоляция кластеров**: Ресурсы и домены из кластера A никогда не видны в кластере B
- **Обязательные ассоциации**: Ресурсы должны быть связаны с доменами, домены должны быть связаны с кластерами
- **Frontend валидация**: Валидация форм предотвращает создание осиротевших сущностей
- **Backend валидация**: Серверная валидация обеспечивает целостность данных
- **Сохранение контекста**: Навигация поддерживает контекст кластера на протяжении всего пользовательского пути

## Связанная документация
- [Сервис Resources Backend](../../../apps/resources-srv/base/README.md)
- [Документация приложения Resources](../../../docs/ru/applications/resources/README.md)

---

**Universo Platformo | Приложение Resources Frontend**
