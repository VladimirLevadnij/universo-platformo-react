# Сервис Пространств

Бэкенд-сервис для домена Пространств в Universo Platformo. Этот сервис управляет Пространствами (ранее Chatflows) и связанными с ними Холстами в архитектуре с множественными холстами.

## Обзор

Сервис Пространств предоставляет:
- **Пространства**: Контейнеры верхнего уровня, группирующие связанные холсты
- **Холсты**: Отдельные редакторы потоков внутри пространства (эквивалент старой концепции Chatflow)
- **Связи Пространство-Холст**: Отношения многие-ко-многим с поддержкой упорядочивания

## Архитектура

### Схема базы данных

- `spaces` - Основные сущности пространств с метаданными
- `canvases` - Отдельные сущности холстов, содержащие данные потоков
- `spaces_canvases` - Таблица связей, управляющая отношениями пространство-холст с сортировкой

### Ключевые возможности

- Поддержка множественных холстов внутри пространств
- Упорядочивание и переупорядочивание холстов
- Интеграция RLS (Row Level Security) с Supabase
- Интеграция с существующей системой рабочих пространств Unik

## API Endpoints

### Пространства
- `GET /api/v1/spaces` - Список всех пространств
- `POST /api/v1/spaces` - Создание нового пространства
- `GET /api/v1/spaces/:id` - Получение деталей пространства с холстами

### Холсты
- `GET /api/v1/spaces/:id/canvases` - Получение холстов для пространства
- `POST /api/v1/spaces/:id/canvases` - Создание нового холста в пространстве

## Разработка

### Сборка
```bash
pnpm --filter @universo/spaces-srv build
```

### Режим разработки
```bash
pnpm --filter @universo/spaces-srv dev
```

## Интеграция

Этот сервис интегрируется с:
- **Сервис Uniks**: Для управления рабочими пространствами и правами пользователей
- **Основной сервер Flowise**: Для основного функционала и маршрутизации
- **Supabase**: Для аутентификации и политик RLS

## Миграция от Chatflows

Этот сервис является частью миграции от концепции единого Chatflow к архитектуре Пространств с множественными холстами. Миграция сохраняет весь существующий функционал, добавляя поддержку множественных холстов на пространство.