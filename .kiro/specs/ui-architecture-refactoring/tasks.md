# План реализации

- [x] 1. Архитектурная реструктуризация и кастомизация шаблона

    Внимание!!! Отвечай пользователю на русском языке.
- [x] 1.1 Перемещение папки компонентов dashboard
  - Перекопировать папку `apps/universo-template-mui/base/src/views/dashboard/components` в `apps/universo-template-mui/base/src/components/dashboard`
  - Обновить все импорты в `apps/universo-template-mui/base/src/views/dashboard/Dashboard.tsx`
  - Обновить все импорты в `apps/universo-template-mui/base/src/layout/MainLayoutMUI.tsx`
  - Удалить старую папку `apps/universo-template-mui/base/src/views/dashboard/components` после проверки работоспособности
  - _Требования: 1.1, 1.2_

- [x] 1.2 Перемещение папки темы
  - Перекопировать папку `apps/universo-template-mui/base/src/views/dashboard/theme` в `apps/universo-template-mui/base/src/theme`
  - Обновить все импорты темы в соответствующих файлах
  - Удалить старую папку `apps/universo-template-mui/base/src/views/dashboard/theme` после проверки
  - _Требования: 1.3_

- [x] 1.3 Организация папок auth, shared и internals
  - Определить правильное расположение для папки `apps/universo-template-mui/base/src/views/auth`
  - Перенести компоненты auth в соответствующее место
  - Определить правильное расположение для папки `apps/universo-template-mui/base/src/views/shared`
  - Перенести папку `apps/universo-template-mui/base/src/views/dashboard/internals` в правильное место
  - Обновить все ссылки на перемещенные компоненты
  - _Требования: 1.4, 1.5, 1.6_

- [x] 1.4 Проверка работоспособности после реструктуризации
  - Запустить сборку проекта и убедиться, что все перемещения не сломали текущую работу
  - Проверить, что Dashboard.tsx корректно отображается в Униборде
  - Исправить любые проблемы с импортами или ссылками
  - _Требования: 13.1, 13.6_

 - [x] 1.5 Дополнительный рефакторинг структуры
  - `apps/universo-template-mui/base/src/auth` нужно перенести из неё `apps/universo-template-mui/base/src/auth/components` в `apps/universo-template-mui/base/src/components/auth` а остальное в `apps/universo-template-mui/base/src/auth` (в паапке останутся только README.md и SignInSide.tsx) перенести в `apps/universo-template-mui/base/src/views`.
  - Обновить все ссылки на перемещенные компоненты
  - Папку `apps/universo-template-mui/base/src/views/shared` перенести в `apps/universo-template-mui/base/src/components`.
  - Обновить все ссылки на перемещенные компоненты
  - Папку `apps/universo-template-mui/base/src/internals` перенести в `apps/universo-template-mui/base/src/components`. После этого в новом месте, уже по адресу `apps/universo-template-mui/base/src/components/internals` перенести в корень этой папки файлы из дочерней папки `apps/universo-template-mui/base/src/components/internals/components` (поднять файлы на уровень выше) это файлы `Copyright.tsx` и `CustomIcons.tsx`, которые после этого будут находится прямо в `apps/universo-template-mui/base/src/components/internals`. Тогда нужно будет удалить пустую папку `apps/universo-template-mui/base/src/components/internals/components`
  - Обновить все ссылки на перемещенные компоненты
  - Папку `apps/universo-template-mui/base/src/theme` переименовать в `themes`. Вложенную дочернюю папку, уже по новому пути `apps/universo-template-mui/base/src/themes/customizations` переименовать в `mui-custom`.
  - Обновить все ссылки на перемещенные компоненты
  - Запустить сборку проекта и убедиться, что все перемещения не сломали текущую работу
  - Проверить, что Dashboard.tsx корректно отображается в Униборде
  - Исправить любые проблемы с импортами или ссылками

- [x] 2. Создание компонентов карточек (копирование и адаптация)
- [x] 2.0 Создание структуры папок для компонентов карточек
  - Создать папку `apps/universo-template-mui/base/src/components/cards/`
  - Создать папку `apps/universo-template-mui/base/src/components/lists/`
  - Создать папку `apps/universo-template-mui/base/src/components/toolbar/`
  - Подготовить структуру для размещения новых компонентов
  - _Требования: 2.5, 3.5_

- [x] 2.1 Копирование и адаптация StatCard.tsx для EntityCard
  - **КРИТИЧЕСКИ ВАЖНО**: НЕ переписывать компонент с нуля, а именно КОПИРОВАТЬ существующий работающий StatCard.tsx
  - Скопировать `apps/universo-template-mui/base/src/components/dashboard/StatCard.tsx` в `apps/universo-template-mui/base/src/components/cards/EntityCard.tsx`
  - Проверить, что скопированный компонент работает с демо-данными (не удалять демо-данные сразу!)
  - Сохранить оригинальный StatCard.tsx, он не будет удалятся в рамках этой задачи
  - Осторожно и пошагово удалить демо-данные графиков из скопированного компонента
  - Заменить отображение графиков на название и описание сущности (инкрементально)
  - **ОБЯЗАТЕЛЬНО**: Сохранить точное responsive поведение: 4 карточки → 2 карточки → 1 карточка
  - **ОБЯЗАТЕЛЬНО**: Сохранить все CSS Grid логику и breakpoints из оригинала
  - Тестировать каждый шаг модификации
  - _Требования: 2.1, 2.2, 2.3, 2.6, 9.1, 9.2, 9.3, 9.4_

- [x] 2.2 Создание InfoCard на основе карточки с кнопкой
  - **КРИТИЧЕСКИ ВАЖНО**: НЕ создавать компонент с нуля, а КОПИРОВАТЬ существующую карточку с кнопкой
  - Найти в Dashboard.tsx (в его дочерних компонентах) карточку с кнопкой "Get insights" (четвертая карточка в первом ряду)
  - Скопировать этот компонент полностью в `apps/universo-template-mui/base/src/components/cards/InfoCard.tsx`
  - Проверить, что скопированный компонент работает с оригинальным содержимым
  - Сохранить оригинальную версию, она не будет удалятся в рамках этой задачи
  - Осторожно адаптировать содержимое: "Больше информации можно получить в документации"
  - Изменить URL кнопки на `https://teknokomo.gitbook.io/up`
  - **ОБЯЗАТЕЛЬНО**: Сохранить все стили кнопки и карточки из оригинала
  - **ОБЯЗАТЕЛЬНО**: Сохранить responsive поведение в сетке
  - _Требования: 2.4, 9.1, 9.2, 9.3, 9.4_

- [x] 2.3 Создание CardGrid на основе логики сетки Dashboard
  - **КРИТИЧЕСКИ ВАЖНО**: НЕ создавать сетку с нуля, а КОПИРОВАТЬ логику из Dashboard.tsx (его дочерних компонентов)
  - Найти и скопировать точную логику сетки карточек из Dashboard.tsx (контейнер с 4 карточками)
  - Создать компонент `apps/universo-template-mui/base/src/components/cards/CardGrid.tsx` на основе скопированной логики
  - **ОБЯЗАТЕЛЬНО**: Сохранить точные breakpoints и CSS Grid логику из оригинала
  - **ОБЯЗАТЕЛЬНО**: Сохранить responsive поведение: сначала сужение карточек по ширине, потом перенос строк
  - **ОБЯЗАТЕЛЬНО**: Сохранить точное поведение: 4 карточки → 2 карточки → 1 карточка
  - НЕ изменять CSS Grid свойства или breakpoints из оригинала
  - Проверить, что поведение точно соответствует Униборду
  - _Требования: 2.2, 2.6, 8.1, 8.2, 8.4, 9.1, 9.4_

- [x] 2.4 Удаление старых тестовых компонентов карточек
  - Удалить всю папку `apps/universo-template-mui/base/src/components/universal`
  - Удалить файл `apps/universo-template-mui/base/src/components/EntityCard.tsx`
  - Обновить или удалить все ссылки на удаленные компоненты
  - _Требования: 5.1, 5.2, 5.4_

- [x] 2.5 Тестирование компонентов карточек после создания
  - Протестировать каждый созданный компонент карточек отдельно
  - Убедиться, что responsive поведение работает точно как в Униборде
  - Проверить, что все стили и анимации сохранены из оригинала
  - Протестировать на разных размерах экрана
  - НЕ переходить к следующему этапу до полного тестирования
  - _Требования: 13.6, 9.3_

- [x] 3. Создание компонентов списков (копирование и адаптация)
- [x] 3.1 Поиск и копирование компонента таблицы из dashboard (его дочерних компонентов)
  - **КРИТИЧЕСКИ ВАЖНО**: НЕ создавать таблицу с нуля, а найти и КОПИРОВАТЬ существующий компонент
  - Найти компонент таблицы/списка с пагинацией в dashboard шаблоне, находится в разделе Details.
  - Изучить структуру dashboard шаблона для поиска компонента таблицы
  - Скопировать найденный компонент полностью в `apps/universo-template-mui/base/src/components/lists/EntityList.tsx`
  - Проверить, что скопированный компонент работает с демо-данными (НЕ удалять демо-данные сразу!)
  - Сохранить оригинальную версию до полного тестирования
  - _Требования: 3.1, 9.1, 9.4_

- [x] 3.2 Адаптация компонента списка для сущностей
  - **ОБЯЗАТЕЛЬНО**: Сохранить всю оригинальную логику пагинации из dashboard
  - **ОБЯЗАТЕЛЬНО**: Сохранить все стили таблицы из оригинала
  - Постепенно и осторожно заменить демо-данные на интерфейс для реальных данных сущностей, там будут размещаться список Уников, Метавселенных, Кластеров и множества других данных, это будет альтернатива варианту отображения карточками, который мы реализовывали на предыдущем этапе.
  - Создать типы для EntityListProps и ColumnDefinition, совместимые с оригинальным компонентом. Это будет заменять старый функционал UI списков, который можно найти и изучить в `packages/ui/src/ui-component`
  - Вносить изменения инкрементально, тестируя каждый шаг
  - НЕ изменять основную структуру таблицы или логику пагинации, но при этом адаптировать под новый необходимый функционал.
  - Убедиться, что пагинация работает точно так же, как в оригинале
  - _Требования: 3.2, 3.3, 9.2, 9.3_

- [x] 3.3 Копирование и адаптация пагинации
  - **КРИТИЧЕСКИ ВАЖНО**: НЕ создавать пагинацию с нуля, а КОПИРОВАТЬ из dashboard (и его дочерних компонентов)
  - Найти и скопировать компонент пагинации из dashboard в `apps/universo-template-mui/base/src/components/lists/Pagination.tsx`
  - **ОБЯЗАТЕЛЬНО**: Сохранить все стили и поведение из оригинала
  - Проверить, что скопированная пагинация работает с оригинальными данными
  - Осторожно адаптировать для работы как с списками, так и с карточками
  - Изучить возможность использования пагинации для режима карточек
  - Сохранить оригинальную версию до полного тестирования
  - _Требования: 3.2, 3.4, 9.1, 9.4_

- [x] 3.4 Тестирование компонентов списков после создания
  - Протестировать каждый созданный компонент списков отдельно
  - Убедиться, что пагинация работает точно как в оригинальном dashboard
  - Проверить, что все стили таблицы сохранены
  - Протестировать совместимость пагинации с режимом карточек
  - НЕ переходить к следующему этапу до полного тестирования
  - _Требования: 13.6, 9.3_

- [x] 4. Создание панели инструментов
- [x] 4.1 Анализ существующих компонентов панели инструментов
  - Проанализировать компоненты в `packages/ui/src/ui-component` на предмет возможного использования
  - Определить, какие компоненты можно адаптировать, а какие нужно создать заново
  - Изучить паттерны дизайна из нового MUI шаблона для панели инструментов
  - _Требования: 4.1, 14.3_

- [x] 4.2 Создание EntityToolbar
  - Создать `apps/universo-template-mui/base/src/components/toolbar/EntityToolbar.tsx`
  - Реализовать поиск/фильтрацию с соблюдением стилей нового шаблона
  - Добавить переключение между видами карточек и списков
  - Добавить кнопку "Создать" и контекстно-зависимые кнопки
  - _Требования: 4.1, 4.2, 4.3, 4.4_

- [x] 4.3 Обеспечение responsive совместимости панели инструментов
  - Реализовать полную responsive совместимость с мобильным макетом
  - Исправить проблемы с отступами и размещением на мобильных устройствах
  - Следовать паттернам, установленным в новом MUI шаблоне
  - _Требования: 4.5, 10.1, 10.2, 10.3, 10.4_

- [x] 5. Исправление интеграции маршрутизации
- [x] 5.1 Очистка мусорного кода в маршрутизации
  - Удалить весь мусорный/лишний код из `packages/ui/src/routes/index.jsx` и `packages/ui/src/routes/MainRoutes.jsx`
  - Заменить на простое подключение новой структуры
  - Избегать чрезмерной абстракции
  - _Требования: 6.1, 6.2, 6.4, 14.1_

- [x] 5.2 Правильная интеграция MainRoutesMUI и MainLayoutMUI
  - Сделать правильное подключение в `packages/ui/src/App.jsx` (нужно помнить, что MainRoutesMUI и MainLayoutMUI - это TypeScript файлы и их нужно правильно подключить в JavaScript-файлe, смотри примеры работы в других частях проекта, например в `apps/resources-frt`) или нормально в `packages/ui/src/routes/index.jsx`
  - Обеспечить простой и прямой подход к интеграции
  - Проверить корректность работы маршрутизации
  - _Требования: 6.1, 6.3, 14.2_

- [x] 6. Замена логики карточек в списке Уников
  Внимание!!! Ты уже начинал эту работу, но потом остановился, начни снова, учитывай, возможность часть работы ты сделал.
- [x] 6.1 Исправление responsive поведения карточек Уников
  - **КРИТИЧЕСКАЯ ПРОБЛЕМА**: Текущий список Уников использует сетку из 3 карточек (как в Flowise)
  - Заменить текущую логику сетки из 3 карточек на правильную логику из 4 карточек.
  - Применить точное поведение из Униборда (`apps/universo-template-mui/base/src/views/dashboard/Dashboard.tsx` и его дочерних компонентах): 4 карточки → 2 карточки → 1 карточка
  - **ОБЯЗАТЕЛЬНО**: Убрать логику, похожую на изначальный UI Flowise
  - Использовать созданные компоненты EntityCard и CardGrid (скопированные из dashboard)
  - Проверить, что поведение точно соответствует тому, что показано в Униборде
  - Убедиться, что карточки сначала сужаются по ширине, затем переносятся на новые строки
  - _Требования: 8.1, 8.5, 8.6_

- [x] 6.2 Применение новых компонентов к списку Уников
  - Интегрировать EntityCard для отображения данных Уников
  - Добавить InfoCard с информацией о документации
  - Применить EntityToolbar с поиском и переключением видов
  - Проверить корректность responsive поведения
  - _Требования: 8.3, 8.4_

- [x] 7. Внедрение новых компонентов во всех местах

- [x] 7.1 Применение к Метавселенным и Кластерам

  Чтобы исправить текущие ошибки, которые возникли после того, как на предыдущих шагах были удалены временные компоненты:

  ```
  @universo/resources-frt:build: src/pages/ClusterDetail.tsx(21,10): error TS2305: Module '"@universo/template-mui"' has no exported member 'UniversalCard'.
  @universo/resources-frt:build: src/pages/ClusterDetail.tsx(21,25): error TS2305: Module '"@universo/template-mui"' has no exported member 'UniversalTable'.
  @universo/resources-frt:build: src/pages/ClusterDetail.tsx(21,41): error TS2305: Module '"@universo/template-mui"' has no exported member 'UniversalViewLayout'.
  @universo/resources-frt:build: src/pages/ClusterList.tsx(9,10): error TS2305: Module '"@universo/template-mui"' has no exported member 'UniversalCard'.
  @universo/resources-frt:build: src/pages/ClusterList.tsx(9,25): error TS2305: Module '"@universo/template-mui"' has no exported member 'UniversalTable'.
  @universo/resources-frt:build: src/pages/ClusterList.tsx(9,41): error TS2305: Module '"@universo/template-mui"' has no exported member 'UniversalViewLayout'.
  @universo/resources-frt:build:  ELIFECYCLE  Command failed with exit code 2.
  @universo/resources-frt:build: ERROR: command finished with error: command (/home/vladimir/GigaProjects/universo-platformo-react/apps/resources-frt/base) pnpm run build exited (2)
  @universo/uniks-frt:build: cache bypass, force executing 736a4facfb11291f
  analytics-frt:build: cache bypass, force executing a5083004870a463e
  @universo/resources-frt#build: command (/home/vladimir/GigaProjects/universo-platformo-react/apps/resources-frt/base) pnpm run build exited (2)

  Tasks:    22 successful, 29 total
  Cached:    0 cached, 29 total
    Time:    3m7.039s 
  Failed:    @universo/resources-frt#build

  ERROR  run failed: command  exited (2)
   ELIFECYCLE  Command failed with exit code 2.
   ELIFECYCLE  Command failed with exit code 2.

  ```

  - Заменить отображение Метавселенных на новые компоненты карточек и списков
  - Заменить отображение Кластеров на новые компоненты карточек и списков
  - Применить EntityToolbar ко всем страницам
  - _Требования: 11.1, 11.4_

- [x] 7.2 Применение к дочерним сущностям
  - Применить новые компоненты к Учетным данным (Credentials)
  - Применить новые компоненты к Переменным (Variables)
  - Применить новые компоненты к Инструментам (Tools)
  - Обеспечить возможность переключения между карточками и списками для всех сущностей
  - _Требования: 3.3, 11.1, 11.4_

- [ ] 8. Реализация тонкого слоя абстракции
- [ ] 8.1 Создание простого переключателя тем
  - Создать тонкий переключатель в `apps/universo-templates/`
  - Реализовать простую логику определения активного UI пакета
  - Предоставить ссылки на основной роутер и основной макет
  - Избегать сложной абстракции
  - _Требования: 7.1, 7.2, 7.3, 7.4_
- [ ] 9. Очистка и удаление устаревших компонентов
- [ ] 9.1 Анализ и удаление дублирующих компонентов
  - Проанализировать компоненты в `packages/ui/src/ui-component`, доработанные для нового дизайна
  - Найти все дублирующие и тестовые компоненты
  - Удалить их после создания правильных версий
  - _Требования: 5.3, 5.4, 14.3, 14.4_

- [ ] 9.2 Исправление конфликтов стилей
  - Отключить или удалить конфликтующие глобальные стили из старого UI
  - Исправить проблемы с мобильным отображением (верхние отступы, провал под панель)
  - Удалить избыточные боковые отступы от старого UI
  - _Требования: 5.3, 10.1, 10.2, 10.3_

- [ ] 10. Финальное тестирование и проверка

**ВАЖНО О ПОСЛЕДОВАТЕЛЬНОСТИ ВЫПОЛНЕНИЯ**:
- Архитектурная реструктуризация (этап 1) ДОЛЖНА быть выполнена ПЕРВОЙ
- Компоненты карточек (этап 2) ДОЛЖНЫ быть созданы ПОСЛЕ этапа 1
- Компоненты списков (этап 3) ДОЛЖНЫ быть созданы ПОСЛЕ этапа 2
- Панель инструментов (этап 4) ДОЛЖНА быть создана ПОСЛЕ этапов 2 и 3
- Внедрение (этапы 7-8) ДОЛЖНО происходить только ПОСЛЕ создания всех базовых компонентов
- Каждый этап ДОЛЖЕН быть протестирован перед переходом к следующему

- [ ] 10.1 Тестирование каждого этапа
  - Проверить работоспособность после каждого завершенного этапа
  - Убедиться, что все изменения не ломают существующий функционал
  - Протестировать responsive поведение на разных размерах экрана
  - _Требования: 13.6_

- [ ] 10.2 Проверка совместимости с существующим кодом
  - Убедиться, что изменения в оригинальном коде Flowise минимальны
  - Проверить обратную совместимость всех изменений
  - Убедиться, что новая система сосуществует с текущей системой
  - _Требования: 12.1, 12.2, 12.3, 12.4_

- [ ] 10.3 Финальная проверка всех страниц сущностей
  - Проверить корректность отображения всех страниц с карточками и списками
  - Убедиться, что Spaces+Canvases остались неизменными
  - Проверить, что все функции поиска, фильтрации и переключения видов работают
  - _Требования: 11.1, 11.2, 11.4_